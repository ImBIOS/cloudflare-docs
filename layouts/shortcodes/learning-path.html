{{- $filename := default (.Get "file") (.Get 0) -}}
{{ $data := slice }}
{{ $fileplaceholder := "" }}

<!-- Get the data from the correct folder -->
<!-- Get previous generation of learning paths from ./assets/json folder -->
{{- range readDir "./assets/json/" -}}
{{- if eq .Name $filename }}
{{- $fileplaceholder :=  print "./assets/json/" .Name -}}
{{- $file_data := getJSON $fileplaceholder -}}
{{ $data = $data | append $file_data }}
{{- end -}}
{{- end -}}

<!-- Get new generation of learning paths from ./data/learning-paths folder -->
{{- range readDir "./data/learning-paths/" -}}
{{- if eq .Name $filename }}
{{- $fileplaceholder :=  print "./data/learning-paths/" .Name -}}
{{- $file_data := getJSON $fileplaceholder -}}
{{ $data = $data | append $file_data }}
{{- end -}}
{{- end -}}

{{ $pathUID := index (index $data 0) "uid" }}

<p class="viewOtherPaths"><a href="/learning-paths/"><strong>&lt;</strong>  View other learning paths</a></p>

{{- range $data -}}

<div class="header">
<h1>{{- .title -}}</h1>
<p><em>Learning path</em></p>
<p>{{- .description | markdownify -}}</p>
<p>{{- .detailed_description | markdownify -}}</p>
</div>

<div class="background">
{{- range $index, $module := .modules -}}
{{- $moduleID := index $module "uid" }}
{{- $moduleData := index $.Site.Data.modules ($moduleID | string) -}}


<div class="learningPathModule">
  <div class="moduleHeader">
  <h2 id="{{ $moduleData.title | safeURL | anchorize }}"><span class="DocsMarkdown--header-anchor-positioner">
      <a
        class="DocsMarkdown--header-anchor Link Link-without-underline"
        href="#{{ $moduleData.title | safeURL | anchorize }}"
        >&#8203;â€‹</a
      >
    </span>
    <span>{{$moduleData.title}}</span>
  </h2>
  </div>
  {{ with $moduleData.summary }}
  <p>{{. | markdownify }}</p>
  {{ end }}
 
  <p class="DocsMarkdown--button-group">
    <span class="DocsMarkdown--button-group-content">
      <a href="{{print $moduleData.url "?learning_path=" $pathUID }}" class="learningNavigation Button Button-is-docs-primary">
        <span class="DocsMarkdown--link-content">Start</span>
      </a>
  </span>
</p>

  {{- if eq $index 0 -}}
  <details open>
  {{ else }}
  <details>
  {{ end }}

    {{ $moduleUnits := $moduleData.units }}

    <summary>Overview</summary>
    <div>
        <ul>
        {{- range $moduleUnits -}}
          {{- with $.Site.GetPage (replaceRE "/$" "" .url) -}}
          
          <li><a href="{{ print .RelPermalink "?learning_path=" $pathUID }}">{{.Title }}</a>
            <p style="margin-top: -2em; font-size: .8em">{{ .ReadingTime }} mins</p>
          {{- end -}}
        {{- end -}}
        
        </li>
        </ul>

    </div>
    </details>
    </div>


{{- end -}}

</div>

{{- end -}}
