{{- $layout := .Params.layout -}}
{{- $currentLocation := .RelPermalink -}}
{{- $splitURL := split $currentLocation "/" -}}
{{- $currentModule := index $splitURL 4 -}}
{{- $currentUnit := index $splitURL 5 -}}
{{- $moduleData :=  index .Site.Data.modules $currentModule -}}
{{- $moduleLength := len (index $moduleData "units") -}}
{{- $baseURL := "/learning-paths/modules/" -}}
{{- $previousUnit := "" -}}
{{- $nextUnit := "" -}}
{{- $currentUnitNumber := 0 -}}



{{- if eq $layout "learning-module" -}}
    {{- $nextUnit = index (index (index $moduleData "units") 0) "url" -}}

    <a href="{{$nextUnit}}" class="learningNavigation  Button Button-is-docs-primary">
        <span class="DocsMarkdown--link-content">Start module</span>
    </a>

{{- else -}}

    {{- range $index, $item := (index $moduleData "units") -}}
        {{- if eq $currentLocation $item.url -}}
            {{- $currentUnitNumber = (add $index 1) -}}
            {{- if ne $index (sub $moduleLength 1) -}}
                {{- $nextUnit = index (index (index $moduleData "units") (add $index 1)) "url" -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}    

    {{- with .NextInSection -}}
        {{- $previousUnit = .RelPermalink -}}
    {{- end -}}

    {{- with .PrevInSection -}}
        {{- $nextUnit = .RelPermalink -}}
{{- end -}}

<div class="progressIndicator">
{{- if eq $layout "learning-unit" -}}
<p>Unit {{ $currentUnitNumber }} of {{ $moduleLength }}</p>
{{- end -}}

<p class="DocsMarkdown--button-group" style="align-items: center;">
<span class="DocsMarkdown--button-group-content">
{{- if ne $previousUnit "" -}}
    <a href="{{- $previousUnit -}}" id="previousLink" class="learningNavigation Button Button-is-docs-secondary">
        <span class="DocsMarkdown--link-content">Previous</span>
    </a>
    <br/>
{{- end -}}
{{- if ne $nextUnit "" -}}
    <a href="{{- $nextUnit -}}" id="nextLink" class="learningNavigation Button Button-is-docs-primary">
        <span class="DocsMarkdown--link-content">Next</span>
    </a>
{{- else -}}
    <a href="{{- $baseURL -}}" id="nextModuleLink" class="Button Button-is-docs-primary">
        <span class="DocsMarkdown--link-content">Finish module</span>
        </a>
{{- end -}}
</span>
</p>
{{- end -}}
</div>